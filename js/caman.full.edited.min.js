(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},C=[].slice,D={}.hasOwnProperty,E=function(a,b){return function(){return a.apply(b,arguments)}},F=function(a,b){function d(){this.constructor=a}for(var c in b)D.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};y=["extended","included"],p=function(){function a(){}return a["extends"]=function(a){var b,c,d;for(b in a)c=a[b],B.call(y,b)<0&&(this[b]=c);return null!=(d=a.extended)&&d.apply(this),this},a.includes=function(a){var b,c,d;for(b in a)c=a[b],B.call(y,b)<0&&(this.prototype[b]=c);return null!=(d=a.included)&&d.apply(this),this},a.delegate=function(){var a,b,c,d,e,f;for(a=1<=arguments.length?C.call(arguments,0):[],c=a.pop(),f=[],d=0,e=a.length;e>d;d++)b=a[d],f.push(this.prototype[b]=c.prototype[b]);return f},a.aliasFunction=function(a,b){var c=this;return this.prototype[a]=function(){var a;return a=1<=arguments.length?C.call(arguments,0):[],c.prototype[b].apply(c,a)}},a.aliasProperty=function(a,b){return Object.defineProperty(this.prototype,a,{get:function(){return this[b]},set:function(a){return this[b]=a}})},a.included=function(a){return a.call(this,this.prototype)},a}(),z=Array.prototype.slice,a=function(a,b){return null==b&&(b=document),"object"==typeof a||"undefined"!=typeof exports&&null!==exports?a:b.querySelector(a)},v=function(){function a(){}return a.uniqid=function(){var a;return a=0,{get:function(){return a++}}}(),a.extend=function(){var a,b,c,d,e,f,g;for(c=arguments[0],e=2<=arguments.length?C.call(arguments,1):[],b=c,f=0,g=e.length;g>f;f++){a=e[f];for(d in a)D.call(a,d)&&(b[d]=a[d])}return b},a.clampRGB=function(a){return 0>a?0:a>255?255:a},a.copyAttributes=function(a,b,c){var d,e,f,g,h,i;for(null==c&&(c={}),g=a.attributes,i=[],e=0,f=g.length;f>e;e++)d=g[e],null!=c.except&&(h=d.nodeName,B.call(c.except,h)>=0)||i.push(b.setAttribute(d.nodeName,d.nodeValue));return i},a.dataArray=function(a){return null==a&&(a=0),e.NodeJS||null!=window.Uint8Array?new Uint8Array(a):new Array(a)},a}(),"undefined"!=typeof exports&&null!==exports?(t=exports,g=require("canvas"),m=g.Image,j=require("fibers"),w=require("fs"),x=require("http")):t=window,e=function(c){function d(){this.nodeFileReady=E(this.nodeFileReady,this);var a,c,e,f=this;if(0===arguments.length)throw"Invalid arguments";return this instanceof d?(this.finishInit=this.finishInit.bind(this),this.imageLoaded=this.imageLoaded.bind(this),a=arguments[0],d.NodeJS||(e=parseInt(d.getAttrId(a[0]),10),c="function"==typeof a[1]?a[1]:"function"==typeof a[2]?a[2]:function(){},isNaN(e)||!u.has(e))?(this.id=v.uniqid.get(),this.initializedPixelData=this.originalPixelData=null,this.cropCoordinates={x:0,y:0},this.cropped=!1,this.resized=!1,this.pixelStack=[],this.layerStack=[],this.canvasQueue=[],this.currentLayer=null,this.scaled=!1,this.analyze=new b(this),this.renderer=new s(this),this.domIsLoaded(function(){return f.parseArguments(a),f.setup()}),this):u.execute(e,c)):new d(arguments)}return F(d,c),d.version={release:"4.1.2",date:"7/27/2013"},d.DEBUG=!1,d.allowRevert=!0,d.crossOrigin="anonymous",d.remoteProxy="",d.proxyParam="camanProxyUrl",d.NodeJS="undefined"!=typeof exports&&null!==exports,d.autoload=!d.NodeJS,d.toString=function(){return"Version "+d.version.release+", Released "+d.version.date},d.getAttrId=function(b){return d.NodeJS?!0:("string"==typeof b&&(b=a(b)),null==b||null==b.getAttribute?null:b.getAttribute("data-caman-id"))},d.prototype.domIsLoaded=function(a){var b,c=this;return d.NodeJS?setTimeout(function(){return a.call(c)},0):"complete"===document.readyState?(o.debug("DOM initialized"),setTimeout(function(){return a.call(c)},0)):(b=function(){return"complete"===document.readyState?(o.debug("DOM initialized"),a.call(c)):void 0},document.addEventListener("readystatechange",b,!1))},d.prototype.parseArguments=function(a){var b,c,d,e;if(0===a.length)throw"Invalid arguments given";if(this.initObj=null,this.initType=null,this.imageUrl=null,this.callback=function(){},this.setInitObject(a[0]),1!==a.length){switch(typeof a[1]){case"string":this.imageUrl=a[1];break;case"function":this.callback=a[1]}if(2!==a.length&&(this.callback=a[2],4===a.length)){d=a[4],e=[];for(b in d)D.call(d,b)&&(c=d[b],e.push(this.options[b]=c));return e}}},d.prototype.setInitObject=function(b){if(d.NodeJS)return this.initObj=b,void(this.initType="node");if("object"==typeof b?this.initObj=b:this.initObj=a(b),null==this.initObj)throw"Could not find image or canvas for initialization.";return this.initType=this.initObj.nodeName.toLowerCase()},d.prototype.setup=function(){switch(this.initType){case"node":return this.initNode();case"img":return this.initImage();case"canvas":return this.initCanvas()}},d.prototype.initNode=function(){return o.debug("Initializing for NodeJS"),"string"==typeof this.initObj&&this.initObj.match(/^https?:\/\//)?this.readFromHttp(this.initObj,this.nodeFileReady):"string"==typeof this.initObj?w.readFile(this.initObj,this.nodeFileReady):this.nodeFileReady(null,this.initObj)},d.prototype.readFromHttp=function(a,b){var c;return o.debug("Fetching image from "+a),c=x.get(a,function(a){var c;return c="",a.setEncoding("binary"),a.on("data",function(a){return c+=a}),a.on("end",function(){return b(null,new Buffer(c,"binary"))})}),c.on("error",b)},d.prototype.nodeFileReady=function(a,b){if(a)throw a;return this.image=new m,this.image.src=b,o.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.canvas=new g(this.imageWidth(),this.imageHeight()),this.finishInit()},d.prototype.initImage=function(){return this.image=this.initObj,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),v.copyAttributes(this.image,this.canvas,{except:["src"]}),null!=this.image.parentNode&&this.image.parentNode.replaceChild(this.canvas,this.image),this.imageAdjustments(),this.waitForImageLoaded()},d.prototype.initCanvas=function(){return this.canvas=this.initObj,this.context=this.canvas.getContext("2d"),null!=this.imageUrl?(this.image=document.createElement("img"),this.image.src=this.imageUrl,this.imageAdjustments(),this.waitForImageLoaded()):this.finishInit()},d.prototype.imageAdjustments=function(){return this.needsHiDPISwap()&&(o.debug(this.image.src,"->",this.hiDPIReplacement()),this.swapped=!0,this.image.src=this.hiDPIReplacement()),l.isRemote(this.image)?(this.image.src=l.proxyUrl(this.image.src),o.debug("Remote image detected, using URL = "+this.image.src)):void 0},d.prototype.waitForImageLoaded=function(){return this.isImageLoaded()?this.imageLoaded():this.image.onload=this.imageLoaded},d.prototype.isImageLoaded=function(){return this.image.complete?null!=this.image.naturalWidth&&0===this.image.naturalWidth?!1:!0:!1},d.prototype.imageWidth=function(){return this.image.width||this.image.naturalWidth},d.prototype.imageHeight=function(){return this.image.height||this.image.naturalHeight},d.prototype.imageLoaded=function(){return o.debug("Image loaded. Width = "+this.imageWidth()+", Height = "+this.imageHeight()),this.swapped?(this.canvas.width=this.imageWidth()/this.hiDPIRatio(),this.canvas.height=this.imageHeight()/this.hiDPIRatio()):(this.canvas.width=this.imageWidth(),this.canvas.height=this.imageHeight()),this.finishInit()},d.prototype.finishInit=function(){var a,b,c,e,f;if(null==this.context&&(this.context=this.canvas.getContext("2d")),this.originalWidth=this.preScaledWidth=this.width=this.canvas.width,this.originalHeight=this.preScaledHeight=this.height=this.canvas.height,this.hiDPIAdjustments(),this.hasId()||this.assignId(),null!=this.image&&this.context.drawImage(this.image,0,0,this.imageWidth(),this.imageHeight(),0,0,this.preScaledWidth,this.preScaledHeight),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data,d.allowRevert)for(this.initializedPixelData=v.dataArray(this.pixelData.length),this.originalPixelData=v.dataArray(this.pixelData.length),f=this.pixelData,a=c=0,e=f.length;e>c;a=++c)b=f[a],this.initializedPixelData[a]=b,this.originalPixelData[a]=b;return this.dimensions={width:this.canvas.width,height:this.canvas.height},d.NodeJS||u.put(this.id,this),this.callback.call(this,this),this.callback=function(){}},d.prototype.reloadCanvasData=function(){return this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data},d.prototype.resetOriginalPixelData=function(){var a,b,c,e,f,g;if(!d.allowRevert)throw"Revert disabled";for(this.originalPixelData=v.dataArray(this.pixelData.length),f=this.pixelData,g=[],a=c=0,e=f.length;e>c;a=++c)b=f[a],g.push(this.originalPixelData[a]=b);return g},d.prototype.hasId=function(){return null!=d.getAttrId(this.canvas)},d.prototype.assignId=function(){return d.NodeJS||this.canvas.getAttribute("data-caman-id")?void 0:this.canvas.setAttribute("data-caman-id",this.id)},d.prototype.hiDPIDisabled=function(){return null!==this.canvas.getAttribute("data-caman-hidpi-disabled")},d.prototype.hiDPIAdjustments=function(){var a;if(!d.NodeJS&&this.needsHiDPISwap())return a=this.hiDPIRatio(),1!==a?(o.debug("HiDPI ratio = "+a),this.scaled=!0,this.preScaledWidth=this.canvas.width,this.preScaledHeight=this.canvas.height,this.canvas.width=this.preScaledWidth*a,this.canvas.height=this.preScaledHeight*a,this.canvas.style.width=""+this.preScaledWidth+"px",this.canvas.style.height=""+this.preScaledHeight+"px",this.context.scale(a,a),this.width=this.originalWidth=this.canvas.width,this.height=this.originalHeight=this.canvas.height):void 0},d.prototype.hiDPIRatio=function(){var a,b;return b=window.devicePixelRatio||1,a=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,b/a},d.prototype.hiDPICapable=function(){return null!=window.devicePixelRatio&&1!==window.devicePixelRatio},d.prototype.needsHiDPISwap=function(){return this.hiDPIDisabled()||!this.hiDPICapable()?!1:null!==this.hiDPIReplacement()},d.prototype.hiDPIReplacement=function(){return null==this.image?null:this.image.getAttribute("data-caman-hidpi")},d.prototype.replaceCanvas=function(a){var b;return b=this.canvas,this.canvas=a,this.context=this.canvas.getContext("2d"),d.NodeJS||b.parentNode.replaceChild(this.canvas,b),this.width=this.canvas.width,this.height=this.canvas.height,this.reloadCanvasData(),this.dimensions={width:this.canvas.width,height:this.canvas.height}},d.prototype.render=function(a){var b=this;return null==a&&(a=function(){}),i.trigger(this,"renderStart"),this.renderer.execute(function(){return b.context.putImageData(b.imageData,0,0),a.call(b)})},d.prototype.revert=function(a){var b,c,e,f,g;if(null==a&&(a=!0),!d.allowRevert)throw"Revert disabled";for(g=this.originalVisiblePixels(),b=e=0,f=g.length;f>e;b=++e)c=g[b],this.pixelData[b]=c;return a?this.context.putImageData(this.imageData,0,0):void 0},d.prototype.reset=function(){var a,b,c,d,e,f,g,h,i;for(a=document.createElement("canvas"),v.copyAttributes(this.canvas,a),a.width=this.originalWidth,a.height=this.originalHeight,b=a.getContext("2d"),d=b.getImageData(0,0,a.width,a.height),f=d.data,i=this.initializedPixelData,c=g=0,h=i.length;h>g;c=++g)e=i[c],f[c]=e;return b.putImageData(d,0,0),this.cropCoordinates={x:0,y:0},this.resized=!1,this.replaceCanvas(a)},d.prototype.originalVisiblePixels=function(){var a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,r,s,t,u,v,w;if(!d.allowRevert)throw"Revert disabled";if(k=[],m=this.cropCoordinates.x,e=m+this.width,n=this.cropCoordinates.y,f=n+this.height,this.resized){for(a=document.createElement("canvas"),a.width=this.originalWidth,a.height=this.originalHeight,c=a.getContext("2d"),h=c.getImageData(0,0,a.width,a.height),j=h.data,t=this.originalPixelData,g=p=0,s=t.length;s>p;g=++p)i=t[g],j[g]=i;c.putImageData(h,0,0),l=document.createElement("canvas"),l.width=this.width,l.height=this.height,c=l.getContext("2d"),c.drawImage(a,0,0,this.originalWidth,this.originalHeight,0,0,this.width,this.height),j=c.getImageData(0,0,this.width,this.height).data,o=this.width}else j=this.originalPixelData,o=this.originalWidth;for(g=r=0,u=j.length;u>r;g=r+=4)b=q.locationToCoordinates(g,o),m<=(v=b.x)&&e>v&&n<=(w=b.y)&&f>w&&k.push(j[g],j[g+1],j[g+2],j[g+3]);return k},d.prototype.process=function(a,b){return this.renderer.add({type:k.Type.Single,name:a,processFn:b}),this},d.prototype.processKernel=function(a,b,c,d){var e,f,g;if(null==c&&(c=null),null==d&&(d=0),null==c)for(c=0,e=f=0,g=b.length;g>=0?g>f:f>g;e=g>=0?++f:--f)c+=b[e];return this.renderer.add({type:k.Type.Kernel,name:a,adjust:b,divisor:c,bias:d}),this},d.prototype.processPlugin=function(a,b){return this.renderer.add({type:k.Type.Plugin,plugin:a,args:b}),this},d.prototype.newLayer=function(a){var b;return b=new n(this),this.canvasQueue.push(b),this.renderer.add({type:k.Type.LayerDequeue}),a.call(b),this.renderer.add({type:k.Type.LayerFinished}),this},d.prototype.executeLayer=function(a){return this.pushContext(a)},d.prototype.pushContext=function(a){return this.layerStack.push(this.currentLayer),this.pixelStack.push(this.pixelData),this.currentLayer=a,this.pixelData=a.pixelData},d.prototype.popContext=function(){return this.pixelData=this.pixelStack.pop(),this.currentLayer=this.layerStack.pop()},d.prototype.applyCurrentLayer=function(){return this.currentLayer.applyToParent()},d}(p),t.Caman=e,e.Analyze=function(){function a(a){this.c=a}return a.prototype.calculateLevels=function(){var a,b,c,d,e,f,g;for(b={r:{},g:{},b:{}},a=d=0;255>=d;a=++d)b.r[a]=0,b.g[a]=0,b.b[a]=0;for(a=e=0,g=this.c.pixelData.length;g>e;a=e+=4)b.r[this.c.pixelData[a]]++,b.g[this.c.pixelData[a+1]]++,b.b[this.c.pixelData[a+2]]++;for(c=this.c.pixelData.length/4,a=f=0;255>=f;a=++f)b.r[a]/=c,b.g[a]/=c,b.b[a]/=c;return b},a}(),b=e.Analyze,e.DOMUpdated=function(){var a,b,c,d,e,g;if(b=document.querySelectorAll("img[data-caman]"),b.length>0){for(g=[],d=0,e=b.length;e>d;d++)a=b[d],g.push(c=new f(a,function(){return this.parse(),this.execute()}));return g}},e.autoload&&!function(){return"complete"===document.readyState?e.DOMUpdated():document.addEventListener("DOMContentLoaded",e.DOMUpdated,!1)}(),f=function(){function b(a,b){this.dataStr=a.getAttribute("data-caman"),this.caman=e(a,b.bind(this))}var a;return a="(\\w+)\\((.*?)\\)",b.prototype.parse=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(this.ele=this.caman.canvas,i=new RegExp(a,"g"),j=this.dataStr.match(i),j.length>0){for(i=new RegExp(a),n=[],k=0,l=j.length;l>k;k++){f=j[k],m=f.match(i),h=m[0],d=m[1],b=m[2],g=new Function("return function() {        this."+d+"("+b+");      };");try{e=g(),n.push(e.call(this.caman))}catch(p){c=p,n.push(o.debug(c))}}return n}},b.prototype.execute=function(){var a;return a=this.ele,this.caman.render(function(){return a.parentNode.replaceChild(this.toImage(),a)})},b}(),e.Blender=function(){function a(){}return a.blenders={},a.register=function(a,b){return this.blenders[a]=b},a.execute=function(a,b,c){return this.blenders[a](b,c)},a}(),c=e.Blender,e.Calculate=function(){function a(){}return a.distance=function(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))},a.randomRange=function(a,b,c){var d;return null==c&&(c=!1),d=a+Math.random()*(b-a),c?d.toFixed(c):Math.round(d)},a.luminance=function(a){return.299*a.r+.587*a.g+.114*a.b},a.bezier=function(a,b,c,d,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t;if(null==f&&(f=0),null==g&&(g=255),a[0]instanceof Array?(j=a,f=b,g=c):j=[a,b,c,d],j.length<2)throw"Invalid number of arguments to bezier";for(h={},n=function(a,b,c){return a*(1-c)+b*c},i=function(a,b,c){return Math.min(Math.max(a,b),c)},l=r=0;1e3>r;l=++r){for(q=l/1e3,p=j;p.length>1;){for(o=[],m=s=0,t=p.length-2;t>=0?t>=s:s>=t;m=t>=0?++s:--s)o.push([n(p[m][0],p[m+1][0],q),n(p[m][1],p[m+1][1],q)]);p=o}h[Math.round(p[0][0])]=Math.round(i(p[0][1],f,g))}return k=j[j.length-1][0],h=e.Calculate.missingValues(h,k),null==h[k]&&(h[k]=h[k-1]),h},a.hermite=function(a,b,c){var d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;if(a.length<2)throw"Invalid number of arguments to hermite";for(y={},o=function(a,b,c){return a*(1-c)+b*c},d=function(a,b,c,d){return[a[0]+b[0]+c[0]+d[0],a[1]+b[1]+c[1]+d[1]]},r=function(a,b){return[a[0]*b[0],a[1]*b[1]]},z=function(a,b){return[a[0]-b[0],a[1]-b[1]]},f=function(a,b,c){return Math.min(Math.max(a,b),c)},g=0,m=B=0,D=a.length-2;D>=0?D>=B:B>=D;m=D>=0?++B:--B)for(t=a[m],u=a[m+1],v=u[0]-t[0],w=1/v,m===a.length-2&&(w=1/(v-1)),s=m>0?a[m-1]:t,p=r(z(u,s),[.5,.5]),s=m<a.length-2?a[m+2]:u,q=r(z(s,t),[.5,.5]),n=C=0;v>=0?v>=C:C>=v;n=v>=0?++C:--C)A=n*w,i=2*A*A*A-3*A*A+1,j=A*A*A-2*A*A+A,k=-2*A*A*A+3*A*A,l=A*A*A-A*A,x=d(r(t,[i,i]),r(p,[j,j]),r(u,[k,k]),r(q,[l,l])),y[Math.round(x[0])]=Math.round(f(x[1],b,c)),g+=1;return h=a[a.length-1][0],y=e.Calculate.missingValues(y,h)},a.missingValues=function(a,b){var c,d,e,f,g,h,i;if(Object.keys(a).length<b+1){for(f={},c=h=0;b>=0?b>=h:h>=b;c=b>=0?++h:--h)if(null!=a[c])f[c]=a[c];else{for(e=[c-1,f[c-1]],d=i=c;b>=c?b>=i:i>=b;d=b>=c?++i:--i)if(null!=a[d]){g=[d,a[d]];break}f[c]=e[1]+(g[1]-e[1])/(g[0]-e[0])*(c-e[0])}return f}return a},a}(),d=e.Calculate,e.Convert=function(){function a(){}return a.hexToRGB=function(a){var b,c,d;return"#"===a.charAt(0)&&(a=a.substr(1)),d=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),b=parseInt(a.substr(4,2),16),{r:d,g:c,b:b}},a.rgbToHSL=function(a,b,c){var d,e,f,g,h,i;return"object"==typeof a&&(b=a.g,c=a.b,a=a.r),a/=255,b/=255,c/=255,g=Math.max(a,b,c),h=Math.min(a,b,c),f=(g+h)/2,g===h?e=i=0:(d=g-h,i=f>.5?d/(2-g-h):d/(g+h),e=function(){switch(g){case a:return(b-c)/d+(c>b?6:0);case b:return(c-a)/d+2;case c:return(a-b)/d+4}}(),e/=6),{h:e,s:i,l:f}},a.hslToRGB=function(a,b,c){var d,e,f,g,h;return"object"==typeof a&&(b=a.s,c=a.l,a=a.h),0===b?h=e=d=c:(g=.5>c?c*(1+b):c+b-c*b,f=2*c-g,h=this.hueToRGB(f,g,a+1/3),e=this.hueToRGB(f,g,a),d=this.hueToRGB(f,g,a-1/3)),{r:255*h,g:255*e,b:255*d}},a.hueToRGB=function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a},a.rgbToHSV=function(a,b,c){var d,e,f,g,h,i;return a/=255,b/=255,c/=255,f=Math.max(a,b,c),g=Math.min(a,b,c),i=f,d=f-g,h=0===f?0:d/f,f===g?e=0:(e=function(){switch(f){case a:return(b-c)/d+(c>b?6:0);case b:return(c-a)/d+2;case c:return(a-b)/d+4}}(),e/=6),{h:e,s:h,v:i}},a.hsvToRGB=function(a,b,c){var d,e,f,g,h,i,j,k;switch(g=Math.floor(6*a),e=6*a-g,h=c*(1-b),i=c*(1-e*b),k=c*(1-(1-e)*b),g%6){case 0:j=c,f=k,d=h;break;case 1:j=i,f=c,d=h;break;case 2:j=h,f=c,d=k;break;case 3:j=h,f=i,d=c;break;case 4:j=k,f=h,d=c;break;case 5:j=c,f=h,d=i}return{r:Math.floor(255*j),g:Math.floor(255*f),b:Math.floor(255*d)}},a.rgbToXYZ=function(a,b,c){var d,e,f;return a/=255,b/=255,c/=255,a>.04045?a=Math.pow((a+.055)/1.055,2.4):a/=12.92,b>.04045?b=Math.pow((b+.055)/1.055,2.4):b/=12.92,c>.04045?c=Math.pow((c+.055)/1.055,2.4):c/=12.92,d=.4124*a+.3576*b+.1805*c,e=.2126*a+.7152*b+.0722*c,f=.0193*a+.1192*b+.9505*c,{x:100*d,y:100*e,z:100*f}},a.xyzToRGB=function(a,b,c){var d,e,f;return a/=100,b/=100,c/=100,f=3.2406*a+-1.5372*b+-.4986*c,e=-.9689*a+1.8758*b+.0415*c,d=.0557*a+-.204*b+1.057*c,f>.0031308?f=1.055*Math.pow(f,.4166666667)-.055:f*=12.92,e>.0031308?e=1.055*Math.pow(e,.4166666667)-.055:e*=12.92,d>.0031308?d=1.055*Math.pow(d,.4166666667)-.055:d*=12.92,{r:255*f,g:255*e,b:255*d}},a.xyzToLab=function(a,b,c){var d,e,f,g,h,i;return"object"==typeof a&&(b=a.y,c=a.z,a=a.x),g=95.047,h=100,i=108.883,a/=g,b/=h,c/=i,a=a>.008856451679?Math.pow(a,.3333333333):7.787037037*a+.1379310345,b=b>.008856451679?Math.pow(b,.3333333333):7.787037037*b+.1379310345,c=c>.008856451679?Math.pow(c,.3333333333):7.787037037*c+.1379310345,f=116*b-16,d=500*(a-b),e=200*(b-c),{l:f,a:d,b:e}},a.labToXYZ=function(a,b,c){var d,e,f;return"object"==typeof a&&(b=a.a,c=a.b,a=a.l),e=(a+16)/116,d=e+b/500,f=e-c/200,d=d>.2068965517?d*d*d:.1284185493*(d-.1379310345),e=e>.2068965517?e*e*e:.1284185493*(e-.1379310345),f=f>.2068965517?f*f*f:.1284185493*(f-.1379310345),{x:95.047*d,y:100*e,z:108.883*f}},a.rgbToLab=function(a,b,c){var d;return"object"==typeof a&&(b=a.g,c=a.b,a=a.r),d=this.rgbToXYZ(a,b,c),this.xyzToLab(d)},a.labToRGB=function(a,b,c){},a}(),h=e.Convert,e.Event=function(){function a(){}return a.events={},a.types=["processStart","processComplete","renderStart","renderFinished","blockStarted","blockFinished"],a.trigger=function(a,b,c){var d,e,f,g,h;if(null==c&&(c=null),this.events[b]&&this.events[b].length){for(g=this.events[b],h=[],e=0,f=g.length;f>e;e++)d=g[e],null===d.target||a.id===d.target.id?h.push(d.fn.call(a,c)):h.push(void 0);return h}},a.listen=function(a,b,c){var d,e;return"string"==typeof a&&(e=a,d=b,a=null,b=e,c=d),B.call(this.types,b)<0?!1:(this.events[b]||(this.events[b]=[]),this.events[b].push({target:a,fn:c}),!0)},a}(),i=e.Event,e.Filter=function(){function a(){}return a.Type={Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6},a.register=function(a,b){return e.prototype[a]=b},a}(),k=e.Filter,e.IO=function(){function a(){}return a.domainRegex=/(?:(?:http|https):\/\/)((?:\w+)\.(?:(?:\w|\.)+))/,a.isRemote=function(a){return null==a?!1:this.corsEnabled(a)?!1:this.isURLRemote(a.src)},a.corsEnabled=function(a){var b;return null!=a.crossOrigin&&("anonymous"===(b=a.crossOrigin.toLowerCase())||"use-credentials"===b)},a.isURLRemote=function(a){var b;return b=a.match(this.domainRegex),b?b[1]!==document.domain:!1},a.remoteCheck=function(a){if(this.isURLRemote(a)){if(e.remoteProxy.length)return e.isURLRemote(e.remoteProxy)?void o.info("Cannot use a remote proxy for loading images."):this.proxyUrl(a);o.info("Attempting to load a remote image without a configured proxy. URL: "+a)}},a.proxyUrl=function(a){return""+e.remoteProxy+"?"+e.proxyParam+"="+encodeURIComponent(a)},a.useProxy=function(a){var b;return b={ruby:"rb",python:"py",perl:"pl",javascript:"js"},a=a.toLowerCase(),null!=b[a]&&(a=b[a]),"proxies/caman_proxy."+a},a}(),e.prototype.save=function(){return"undefined"!=typeof exports&&null!==exports?this.nodeSave.apply(this,arguments):this.browserSave.apply(this,arguments)},e.prototype.browserSave=function(a){var b;return null==a&&(a="png"),a=a.toLowerCase(),b=this.toBase64(a).replace("image/"+a,"image/octet-stream"),document.location.href=b},e.prototype.nodeSave=function(a,b,c){var d,e;null==b&&(b=!0),null==c&&(c=null);try{if(e=w.statSync(a),e.isFile()&&!b)return!1}catch(f){d=f,o.debug("Creating output file "+a)}return w.writeFile(a,this.canvas.toBuffer(),function(b){return o.debug("Finished writing to "+a),c?c.call(this,b):void 0})},e.prototype.toImage=function(a){var b;return b=new m,b.src=this.toBase64(a),b.width=this.dimensions.width,b.height=this.dimensions.height,window.devicePixelRatio&&(b.width/=window.devicePixelRatio,b.height/=window.devicePixelRatio),b},e.prototype.toBase64=function(a){return null==a&&(a="png"),a=a.toLowerCase(),this.canvas.toDataURL("image/"+a)},l=e.IO,e.Layer=function(){function b(a){this.c=a,this.filter=this.c,this.options={blendingMode:"normal",opacity:1},this.layerID=v.uniqid.get(),this.canvas="undefined"!=typeof exports&&null!==exports?new g:document.createElement("canvas"),this.canvas.width=this.c.dimensions.width,this.canvas.height=this.c.dimensions.height,this.context=this.canvas.getContext("2d"),this.context.createImageData(this.canvas.width,this.canvas.height),this.imageData=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelData=this.imageData.data}return b.prototype.newLayer=function(a){return this.c.newLayer.call(this.c,a)},b.prototype.setBlendingMode=function(a){return this.options.blendingMode=a,this},b.prototype.opacity=function(a){return this.options.opacity=a/100,this},b.prototype.copyParent=function(){var a,b,c,d;for(b=this.c.pixelData,a=c=0,d=this.c.pixelData.length;d>c;a=c+=4)this.pixelData[a]=b[a],this.pixelData[a+1]=b[a+1],this.pixelData[a+2]=b[a+2],this.pixelData[a+3]=b[a+3];return this},b.prototype.fillColor=function(){return this.c.fillColor.apply(this.c,arguments)},b.prototype.overlayImage=function(b){return"object"==typeof b?b=b.src:"string"==typeof b&&"#"===b[0]&&(b=a(b).src),b?(this.c.renderer.renderQueue.push({type:k.Type.LoadOverlay,src:b,layer:this}),this):this},b.prototype.applyToParent=function(){var a,b,d,e,f,g,h,i,j;for(d=this.c.pixelStack[this.c.pixelStack.length-1],b=this.c.pixelData,j=[],a=h=0,i=b.length;i>h;a=h+=4)g={r:d[a],g:d[a+1],b:d[a+2],a:d[a+3]},f={r:b[a],g:b[a+1],b:b[a+2],a:b[a+3]},e=c.execute(this.options.blendingMode,f,g),e.r=v.clampRGB(e.r),e.g=v.clampRGB(e.g),e.b=v.clampRGB(e.b),null==e.a&&(e.a=f.a),d[a]=g.r-(g.r-e.r)*(this.options.opacity*(e.a/255)),d[a+1]=g.g-(g.g-e.g)*(this.options.opacity*(e.a/255)),j.push(d[a+2]=g.b-(g.b-e.b)*(this.options.opacity*(e.a/255)));return j},b}(),n=e.Layer,e.Logger=function(){function a(){var a,b,c,d;for(d=["log","info","warn","error"],b=0,c=d.length;c>b;b++)a=d[b],this[a]=function(a){return function(){var b,c;if(b=1<=arguments.length?C.call(arguments,0):[],e.DEBUG)try{return console[a].apply(console,b)}catch(d){return c=d,console[a](b)}}}(a);this.debug=this.log}return a}(),o=new e.Logger,e.Pixel=function(){function a(a,b,c,d,e){this.r=null!=a?a:0,this.g=null!=b?b:0,this.b=null!=c?c:0,this.a=null!=d?d:255,this.c=null!=e?e:null,this.loc=0}return a.coordinatesToLocation=function(a,b,c){return 4*(b*c+a)},a.locationToCoordinates=function(a,b){var c,d;return d=Math.floor(a/(4*b)),c=a%(4*b)/4,{x:c,y:d}},a.prototype.setContext=function(a){return this.c=a},a.prototype.locationXY=function(){var a,b;if(null==this.c)throw"Requires a CamanJS context";return b=this.c.dimensions.height-Math.floor(this.loc/(4*this.c.dimensions.width)),a=this.loc%(4*this.c.dimensions.width)/4,{x:a,y:b}},a.prototype.pixelAtLocation=function(b){if(null==this.c)throw"Requires a CamanJS context";return new a(this.c.pixelData[b],this.c.pixelData[b+1],this.c.pixelData[b+2],this.c.pixelData[b+3],this.c)},a.prototype.getPixelRelative=function(b,c){var d;if(null==this.c)throw"Requires a CamanJS context";return d=this.loc+4*this.c.dimensions.width*(-1*c)+4*b,d>this.c.pixelData.length||0>d?new a(0,0,0,255,this.c):this.pixelAtLocation(d)},a.prototype.putPixelRelative=function(a,b,c){var d;if(null==this.c)throw"Requires a CamanJS context";return d=this.loc+4*this.c.dimensions.width*(-1*b)+4*a,newLoc>this.c.pixelData.length||newLoc<0?void 0:(this.c.pixelData[newLoc]=c.r,this.c.pixelData[newLoc+1]=c.g,this.c.pixelData[newLoc+2]=c.b,this.c.pixelData[newLoc+3]=c.a,!0)},a.prototype.getPixel=function(a,b){var c;if(null==this.c)throw"Requires a CamanJS context";return c=this.coordinatesToLocation(a,b,this.width),this.pixelAtLocation(c)},a.prototype.putPixel=function(a,b,c){var d;if(null==this.c)throw"Requires a CamanJS context";return d=this.coordinatesToLocation(a,b,this.width),this.c.pixelData[d]=c.r,this.c.pixelData[d+1]=c.g,this.c.pixelData[d+2]=c.b,this.c.pixelData[d+3]=c.a},a.prototype.toString=function(){return this.toKey()},a.prototype.toHex=function(a){var b;return null==a&&(a=!1),b="#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16),a?b+this.a.toString(16):b},a}(),q=e.Pixel,e.Plugin=function(){function a(){}return a.plugins={},a.register=function(a,b){return this.plugins[a]=b},a.execute=function(a,b,c){return this.plugins[b].apply(a,c)},a}(),r=e.Plugin,e.Renderer=function(){function a(a){this.c=a,this.processNext=E(this.processNext,this),this.renderQueue=[],this.modPixelData=null}return a.Blocks=e.NodeJS?require("os").cpus().length:4,a.prototype.add=function(a){return null!=a?this.renderQueue.push(a):void 0},a.prototype.processNext=function(){var a;if(0===this.renderQueue.length)return i.trigger(this,"renderFinished"),null!=this.finishedFn&&this.finishedFn.call(this.c),this;switch(this.currentJob=this.renderQueue.shift(),this.currentJob.type){case k.Type.LayerDequeue:return a=this.c.canvasQueue.shift(),this.c.executeLayer(a),this.processNext();case k.Type.LayerFinished:return this.c.applyCurrentLayer(),this.c.popContext(),this.processNext();case k.Type.LoadOverlay:return this.loadOverlay(this.currentJob.layer,this.currentJob.src);case k.Type.Plugin:return this.executePlugin();default:return this.executeFilter()}},a.prototype.execute=function(a){return this.finishedFn=a,this.modPixelData=v.dataArray(this.c.pixelData.length),this.processNext()},a.prototype.eachBlock=function(b){var c,d,f,g,h,i,k,l,m,n,o,p,q=this;for(this.blocksDone=0,l=this.c.pixelData.length,d=Math.floor(l/4/a.Blocks),c=4*d,k=c+l/4%a.Blocks*4,p=[],i=n=0,o=a.Blocks;o>=0?o>n:n>o;i=o>=0?++n:--n)m=i*c,g=m+(i===a.Blocks-1?k:c),e.NodeJS?(h=j(function(){return b.call(q,i,m,g)}),f=h.run(),p.push(this.blockFinished(f))):p.push(setTimeout(function(a,c,d){return function(){return b.call(q,a,c,d)}}(i,m,g),0));return p},a.prototype.executeFilter=function(){return i.trigger(this.c,"processStart",this.currentJob),this.currentJob.type===k.Type.Single?this.eachBlock(this.renderBlock):this.eachBlock(this.renderKernel)},a.prototype.executePlugin=function(){return o.debug("Executing plugin "+this.currentJob.plugin),r.execute(this.c,this.currentJob.plugin,this.currentJob.args),o.debug("Plugin "+this.currentJob.plugin+" finished!"),this.processNext()},a.prototype.renderBlock=function(b,c,d){var f,g,h;for(o.debug("Block #"+b+" - Filter: "+this.currentJob.name+", Start: "+c+", End: "+d),i.trigger(this.c,"blockStarted",{blockNum:b,totalBlocks:a.Blocks,startPixel:c,endPixel:d}),g=new q,g.setContext(this.c),f=h=c;d>h;f=h+=4)g.loc=f,g.r=this.c.pixelData[f],g.g=this.c.pixelData[f+1],g.b=this.c.pixelData[f+2],g.a=this.c.pixelData[f+3],this.currentJob.processFn(g),this.c.pixelData[f]=v.clampRGB(g.r),this.c.pixelData[f+1]=v.clampRGB(g.g),this.c.pixelData[f+2]=v.clampRGB(g.b),this.c.pixelData[f+3]=v.clampRGB(g.a);return e.NodeJS?j["yield"](b):this.blockFinished(b)},a.prototype.renderKernel=function(a,b,c){var d,f,g,h,i,k,l,m,n,p,r,s,t,u,w,x,y,z;for(s=this.currentJob.name,g=this.currentJob.bias,k=this.currentJob.divisor,r=this.c.pixelData.length,d=this.currentJob.adjust,f=Math.sqrt(d.length),p=[],o.debug("Rendering kernel - Filter: "+this.currentJob.name),b=Math.max(b,4*this.c.dimensions.width*((f-1)/2)),c=Math.min(c,r-4*this.c.dimensions.width*((f-1)/2)),h=(f-1)/2,u=new q,u.setContext(this.c),l=x=b;c>x;l=x+=4){for(u.loc=l,i=0,m=y=-h;h>=-h?h>=y:y>=h;m=h>=-h?++y:--y)for(n=z=h;-h>=h?-h>=z:z>=-h;n=-h>=h?++z:--z)t=u.getPixelRelative(m,n),p[3*i]=t.r,p[3*i+1]=t.g,p[3*i+2]=t.b,i++;w=this.processKernel(d,p,k,g),this.modPixelData[l]=v.clampRGB(w.r),this.modPixelData[l+1]=v.clampRGB(w.g),this.modPixelData[l+2]=v.clampRGB(w.b),this.modPixelData[l+3]=this.c.pixelData[l+3]}return e.NodeJS?j["yield"](a):this.blockFinished(a)},a.prototype.blockFinished=function(b){var c,d,e;if(b>=0&&o.debug("Block #"+b+" finished! Filter: "+this.currentJob.name),this.blocksDone++,i.trigger(this.c,"blockFinished",{blockNum:b,blocksFinished:this.blocksDone,totalBlocks:a.Blocks}),this.blocksDone===a.Blocks){if(this.currentJob.type===k.Type.Kernel)for(c=d=0,e=this.c.pixelData.length;e>=0?e>d:d>e;c=e>=0?++d:--d)this.c.pixelData[c]=this.modPixelData[c];return b>=0&&o.debug("Filter "+this.currentJob.name+" finished!"),i.trigger(this.c,"processComplete",this.currentJob),this.processNext()}},a.prototype.processKernel=function(a,b,c,d){var e,f,g,h;for(f={r:0,g:0,b:0},e=g=0,h=a.length;h>=0?h>g:g>h;e=h>=0?++g:--g)f.r+=a[e]*b[3*e],f.g+=a[e]*b[3*e+1],f.b+=a[e]*b[3*e+2];return f.r=f.r/c+d,f.g=f.g/c+d,f.b=f.b/c+d,f},a.prototype.loadOverlay=function(a,b){var c,d,e=this;return c=new m,c.onload=function(){return a.context.drawImage(c,0,0,e.c.dimensions.width,e.c.dimensions.height),a.imageData=a.context.getImageData(0,0,e.c.dimensions.width,e.c.dimensions.height),a.pixelData=a.imageData.data,e.c.pixelData=a.pixelData,e.processNext()},d=l.remoteCheck(b),c.src=null!=d?d:b},a}(),s=e.Renderer,e.Store=function(){function a(){}return a.items={},a.has=function(a){return null!=this.items[a]},a.get=function(a){return this.items[a]},a.put=function(a,b){return this.items[a]=b},a.execute=function(a,b){var c=this;return setTimeout(function(){
return b.call(c.get(a),c.get(a))},0),this.get(a)},a.flush=function(a){return null==a&&(a=!1),a?delete this.items[a]:this.items={}},a}(),u=e.Store,c.register("normal",function(a,b){return{r:a.r,g:a.g,b:a.b}}),c.register("multiply",function(a,b){return{r:a.r*b.r/255,g:a.g*b.g/255,b:a.b*b.b/255}}),c.register("screen",function(a,b){return{r:255-(255-a.r)*(255-b.r)/255,g:255-(255-a.g)*(255-b.g)/255,b:255-(255-a.b)*(255-b.b)/255}}),c.register("overlay",function(a,b){var c;return c={},c.r=b.r>128?255-2*(255-a.r)*(255-b.r)/255:b.r*a.r*2/255,c.g=b.g>128?255-2*(255-a.g)*(255-b.g)/255:b.g*a.g*2/255,c.b=b.b>128?255-2*(255-a.b)*(255-b.b)/255:b.b*a.b*2/255,c}),c.register("difference",function(a,b){return{r:a.r-b.r,g:a.g-b.g,b:a.b-b.b}}),c.register("addition",function(a,b){return{r:b.r+a.r,g:b.g+a.g,b:b.b+a.b}}),c.register("exclusion",function(a,b){return{r:128-2*(b.r-128)*(a.r-128)/255,g:128-2*(b.g-128)*(a.g-128)/255,b:128-2*(b.b-128)*(a.b-128)/255}}),c.register("softLight",function(a,b){var c;return c={},c.r=b.r>128?255-(255-b.r)*(255-(a.r-128))/255:b.r*(a.r+128)/255,c.g=b.g>128?255-(255-b.g)*(255-(a.g-128))/255:b.g*(a.g+128)/255,c.b=b.b>128?255-(255-b.b)*(255-(a.b-128))/255:b.b*(a.b+128)/255,c}),c.register("lighten",function(a,b){return{r:b.r>a.r?b.r:a.r,g:b.g>a.g?b.g:a.g,b:b.b>a.b?b.b:a.b}}),c.register("darken",function(a,b){return{r:b.r>a.r?a.r:b.r,g:b.g>a.g?a.g:b.g,b:b.b>a.b?a.b:b.b}}),k.register("fillColor",function(){var a;return a=1===arguments.length?h.hexToRGB(arguments[0]):{r:arguments[0],g:arguments[1],b:arguments[2]},this.process("fillColor",function(b){return b.r=a.r,b.g=a.g,b.b=a.b,b.a=255,b})}),k.register("brightness",function(a){return a=Math.floor(255*(a/100)),this.process("brightness",function(b){return b.r+=a,b.g+=a,b.b+=a,b})}),k.register("saturation",function(a){return a*=-.01,this.process("saturation",function(b){var c;return c=Math.max(b.r,b.g,b.b),b.r!==c&&(b.r+=(c-b.r)*a),b.g!==c&&(b.g+=(c-b.g)*a),b.b!==c&&(b.b+=(c-b.b)*a),b})}),k.register("vibrance",function(a){return a*=-1,this.process("vibrance",function(b){var c,d,e;return e=Math.max(b.r,b.g,b.b),d=(b.r+b.g+b.b)/3,c=2*Math.abs(e-d)/255*a/100,b.r!==e&&(b.r+=(e-b.r)*c),b.g!==e&&(b.g+=(e-b.g)*c),b.b!==e&&(b.b+=(e-b.b)*c),b})}),k.register("greyscale",function(a){return this.process("greyscale",function(a){var b;return b=d.luminance(a),a.r=b,a.g=b,a.b=b,a})}),k.register("contrast",function(a){return a=Math.pow((a+100)/100,2),this.process("contrast",function(b){return b.r/=255,b.r-=.5,b.r*=a,b.r+=.5,b.r*=255,b.g/=255,b.g-=.5,b.g*=a,b.g+=.5,b.g*=255,b.b/=255,b.b-=.5,b.b*=a,b.b+=.5,b.b*=255,b})}),k.register("hue",function(a){return this.process("hue",function(b){var c,d,e,f,g,i;return f=h.rgbToHSV(b.r,b.g,b.b),e=100*f.h,e+=Math.abs(a),e%=100,e/=100,f.h=e,i=h.hsvToRGB(f.h,f.s,f.v),g=i.r,d=i.g,c=i.b,b.r=g,b.g=d,b.b=c,b})}),k.register("colorize",function(){var a,b;return 2===arguments.length?(b=h.hexToRGB(arguments[0]),a=arguments[1]):4===arguments.length&&(b={r:arguments[0],g:arguments[1],b:arguments[2]},a=arguments[3]),this.process("colorize",function(c){return c.r-=(c.r-b.r)*(a/100),c.g-=(c.g-b.g)*(a/100),c.b-=(c.b-b.b)*(a/100),c})}),k.register("invert",function(){return this.process("invert",function(a){return a.r=255-a.r,a.g=255-a.g,a.b=255-a.b,a})}),k.register("sepia",function(a){return null==a&&(a=100),a/=100,this.process("sepia",function(b){return b.r=Math.min(255,b.r*(1-.607*a)+b.g*(.769*a)+b.b*(.189*a)),b.g=Math.min(255,b.r*(.349*a)+b.g*(1-.314*a)+b.b*(.168*a)),b.b=Math.min(255,b.r*(.272*a)+b.g*(.534*a)+b.b*(1-.869*a)),b})}),k.register("gamma",function(a){return this.process("gamma",function(b){return b.r=255*Math.pow(b.r/255,a),b.g=255*Math.pow(b.g/255,a),b.b=255*Math.pow(b.b/255,a),b})}),k.register("noise",function(a){return a=2.55*Math.abs(a),this.process("noise",function(b){var c;return c=d.randomRange(-1*a,a),b.r+=c,b.g+=c,b.b+=c,b})}),k.register("clip",function(a){return a=2.55*Math.abs(a),this.process("clip",function(b){return b.r>255-a?b.r=255:b.r<a&&(b.r=0),b.g>255-a?b.g=255:b.g<a&&(b.g=0),b.b>255-a?b.b=255:b.b<a&&(b.b=0),b})}),k.register("channels",function(a){var b,c;if("object"!=typeof a)return this;for(b in a)D.call(a,b)&&(c=a[b],0!==c?a[b]/=100:delete a[b]);return 0===a.length?this:this.process("channels",function(b){return null!=a.red&&(a.red>0?b.r+=(255-b.r)*a.red:b.r-=b.r*Math.abs(a.red)),null!=a.green&&(a.green>0?b.g+=(255-b.g)*a.green:b.g-=b.g*Math.abs(a.green)),null!=a.blue&&(a.blue>0?b.b+=(255-b.b)*a.blue:b.b-=b.b*Math.abs(a.blue)),b})}),k.register("curves",function(){var a,b,c,e,f,g,h,i,j,k,l,m;if(c=arguments[0],e=2<=arguments.length?C.call(arguments,1):[],h=e[e.length-1],"function"==typeof h?(a=h,e.pop()):"string"==typeof h?(a=d[h],e.pop()):a=d.hermite,"string"==typeof c&&(c=c.split("")),"v"===c[0]&&(c=["r","g","b"]),e.length<2)throw"Invalid number of arguments to curves filter";if(b=a(e,0,255),i=e[0],i[0]>0)for(g=j=0,l=i[0];l>=0?l>j:j>l;g=l>=0?++j:--j)b[g]=i[1];if(f=e[e.length-1],f[0]<255)for(g=k=m=f[0];255>=m?255>=k:k>=255;g=255>=m?++k:--k)b[g]=f[1];return this.process("curves",function(a){var d,e;for(g=d=0,e=c.length;e>=0?e>d:d>e;g=e>=0?++d:--d)a[c[g]]=b[a[c[g]]];return a})}),k.register("exposure",function(a){var b,c,d;return d=Math.abs(a)/100,b=[0,255*d],c=[255-255*d,255],0>a&&(b=b.reverse(),c=c.reverse()),this.curves("rgb",[0,0],b,c,[255,255])}),e.Plugin.register("crop",function(a,b,c,d){var e,f;return null==c&&(c=0),null==d&&(d=0),"undefined"!=typeof exports&&null!==exports?e=new g(a,b):(e=document.createElement("canvas"),v.copyAttributes(this.canvas,e),e.width=a,e.height=b),f=e.getContext("2d"),f.drawImage(this.canvas,c,d,a,b,0,0,a,b),this.cropCoordinates={x:c,y:d},this.cropped=!0,this.replaceCanvas(e)}),e.Plugin.register("resize",function(a){var b,c;return null==a&&(a=null),null===a||null==a.width&&null==a.height?void o.error("Invalid or missing dimensions given for resize"):(null==a.width?a.width=this.canvas.width*a.height/this.canvas.height:null==a.height&&(a.height=this.canvas.height*a.width/this.canvas.width),"undefined"!=typeof exports&&null!==exports?b=new g(a.width,a.height):(b=document.createElement("canvas"),v.copyAttributes(this.canvas,b),b.width=a.width,b.height=a.height),c=b.getContext("2d"),c.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,a.width,a.height),this.resized=!0,this.replaceCanvas(b))}),e.Filter.register("sharpen",function(a){return null==a&&(a=100),a/=100,this.processKernel("Sharpen",[0,-a,0,-a,4*a+1,-a,0,-a,0])}),A={brightness:function(a,b,c){return a.r=a.r-a.r*b*c.strength,a.g=a.g-a.g*b*c.strength,a.b=a.b-a.b*b*c.strength,a},gamma:function(a,b,c){return a.r=255*Math.pow(a.r/255,Math.max(10*b*c.strength,1)),a.g=255*Math.pow(a.g/255,Math.max(10*b*c.strength,1)),a.b=255*Math.pow(a.b/255,Math.max(10*b*c.strength,1)),a},colorize:function(a,b,c){return a.r-=(a.r-c.color.r)*b,a.g-=(a.g-c.color.g)*b,a.b-=(a.b-c.color.b)*b,a}}}).call(this);